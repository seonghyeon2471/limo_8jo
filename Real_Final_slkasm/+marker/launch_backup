<launch>

  <!-- ========================================================= -->
  <!-- 1) LIMO ë³¸ì²´ (ëª¨í„°/IMU/TF/ê¸°ë³¸ bringup)                   -->
  <!-- ========================================================= -->
  <include file="$(find limo_bringup)/launch/limo_start.launch">
    <arg name="pub_odom_tf" value="false"/>
  </include>


  <!-- ========================================================= -->
  <!-- 2) Astra RGB ì¹´ë©”ë¼ ì‹¤í–‰ (dabai_u3.launch)               -->
  <!-- ========================================================= -->
  <include file="$(find astra_camera)/launch/dabai_u3.launch"/>


  <!-- ========================================================= -->
  <!-- 3) LiDAR ê¸°ë°˜ Navigation ì‹¤í–‰                             -->
  <!-- ========================================================= -->
  <include file="$(find limo_bringup)/launch/limo_navigation_diff.launch"/>


  <!-- ========================================================= -->
  <!-- 4) AR TRACK ALVAR (ê°œì„ ëœ ë²„ì „)                          -->
  <!-- ========================================================= -->
  <node pkg="ar_track_alvar"
        type="individualMarkersNoKinect"
        name="ar_track_alvar"
        output="screen">

    <!-- ðŸ”¥ í•„ìˆ˜: ì´ë¯¸ì§€ í† í”½ remap (ì´ê±° ì—†ìœ¼ë©´ ì ˆëŒ€ ì¸ì‹ ì•ˆ ë¨) -->
    <remap from="camera_image" to="/camera/rgb/image_raw"/>
    <remap from="camera_info"  to="/camera/rgb/camera_info"/>

    <!-- ðŸ”¥ í•„ìˆ˜: ì¶œë ¥ ì¢Œí‘œê³„ -->
    <param name="output_frame" value="camera_rgb_optical_frame"/>

    <!-- ë§ˆì»¤ í¬ê¸° (cm ë‹¨ìœ„) -->
    <param name="marker_size" value="12.0"/>

    <!-- ê¸°ìš¸ì–´ì§„ ë§ˆì»¤ ì¸ì‹ ê°•í™” -->
    <param name="max_new_marker_error" value="0.25"/>
    <param name="max_track_error" value="0.20"/>
    <param name="min_confidence" value="0.001"/>

  </node>


  <!-- ========================================================= -->
  <!-- 5) LKAS â€” BEV ê¸°ë°˜ ì°¨ì„  ì¤‘ì•™ ê²€ì¶œ                        -->
  <!-- ========================================================= -->
  <node pkg="limo_slam_lkas"
        type="lane_center_bev.py"
        name="lane_center_bev"
        output="screen">
    <param name="image_topic" value="/camera/rgb/image_raw" />
  </node>


  <!-- ========================================================= -->
  <!-- 6) SLAM + LKAS Override Guard (ìµœì¢… ì œì–´)                -->
  <!-- ========================================================= -->
  <node pkg="limo_slam_lkas"
        type="lkas_slam_guard.py"
        name="lkas_slam_guard"
        output="screen">

    <param name="slam_cmd_topic" value="/cmd_vel_slam" />
    <param name="out_cmd_topic"  value="/cmd_vel" />

    <param name="path_topic" value="/move_base/TrajectoryPlannerROS/local_plan" />
    <param name="base_frame" value="base_link" />

    <param name="depart_threshold" value="0.30" />
    <param name="clear_threshold"  value="0.18" />

    <param name="yaw_gain"  value="1.2" />
    <param name="max_ang"   value="1.0" />
    <param name="deadzone"  value="0.05" />

    <param name="lookahead_min" value="0.30" />
    <param name="lookahead_max" value="0.80" />

    <param name="slam_timeout" value="0.5" />
    <param name="lane_timeout" value="0.5" />
    <param name="path_timeout" value="0.7" />

  </node>

</launch>
