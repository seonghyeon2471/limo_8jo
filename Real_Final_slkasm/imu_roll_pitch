#!/usr/bin/env python
# -*- coding: utf-8 -*-

import rospy
from sensor_msgs.msg import Imu
import math
import sys

def imu_callback(msg):
    ax = msg.linear_acceleration.x
    ay = msg.linear_acceleration.y
    az = msg.linear_acceleration.z

    # 가속도 기반 기울기 계산
    pitch = math.atan2(ax, math.sqrt(ay*ay + az*az))
    roll  = math.atan2(-ay, az)

    pitch_deg = pitch * 180.0 / math.pi
    roll_deg  = roll  * 180.0 / math.pi

    sys.stdout.write("\033[2J\033[H")
    sys.stdout.write("=== LIMO Tilt (Accel Based) ===\n")
    sys.stdout.write("Roll (deg):  %.2f\n" % roll_deg)
    sys.stdout.write("Pitch (deg): %.2f\n" % pitch_deg)
    sys.stdout.write("--------------------------------\n")
    sys.stdout.flush()

def main():
    rospy.init_node("limo_imu_accel_tilt")
    rospy.Subscriber("/imu", Imu, imu_callback)
    rospy.spin()

if __name__ == "__main__":
    main()
